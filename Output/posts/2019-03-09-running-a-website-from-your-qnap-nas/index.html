<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css"/><link rel="stylesheet" href="/Pure/styles.css"/><link rel="stylesheet" href="/all.css"/></head><body><div id="layout" class="pure-g"><div class="sidebar pure-u-1 pure-u-md-1-4"><div class="header"><div id="layout" class="pure-g"><div class="pure-u-md-1-1 pure-u-3-4"><h1 class="brand-title">Bitomule's learning shack</h1><h3 class="brand-tagline">My thoughts about iOS, technology or any other thing that comes to my mind.</h3></div></div><div id="layout" class="pure-g"><div class="pure-u-md-1-1"><a href="mailto:bitomule+blog@gmail.com"><i class="fas fa-envelope-open-text l-box social-icon"></i><a class="social-media" href="mailto:bitomule+blog@gmail.com">Email</a></a></div><div class="pure-u-md-1-1"><a href="https://www.linkedin.com/in/davidcolladosela/"><i class="fab fa-linkedin l-box social-icon"></i><a class="social-media" href="https://www.linkedin.com/in/davidcolladosela/">LinkedIn</a></a></div><div class="pure-u-md-1-1"><a href="https://github.com/bitomule"><i class="fab fa-github-square l-box social-icon"></i><a class="social-media" href="https://github.com/bitomule">GitHub</a></a></div><div class="pure-u-md-1-1"><a href="https://twitter.com/Bitomule"><i class="fab fa-twitter-square l-box social-icon"></i><a class="social-media" href="https://twitter.com/Bitomule">Twitter</a></a></div></div></div></div><div class="content pure-u-1 pure-u-md-3-5 pure-u-xl-6-10"><h2 class="post-title"><a href="/posts/2019-03-09-running-a-website-from-your-qnap-nas">Running a website from your Qnap NAS</a></h2><p class="post-meta">March 9, 2019</p><div class="post-tags"><a class="post-category post-category-web" href="/tags/web">Web</a><a class="post-category post-category-nas" href="/tags/nas">NAS</a></div><div class="post-description"><div><h1>Running a website from your Qnap NAS</h1><p>The first proper post of the blog is something I don't do frequently: playing with the web. In this post, I'll explain how after some hours I got the blog running with a custom domain and SSL using docker in a qnap NAS. The process should work on any NAS (with Synology it could be even easier) but I'll explain it using the Qnap process.</p><h2>You'll need:</h2><ul><li>A Qnap NAS able to run docker</li><li>Static website you want to host (I used Publii for this part)</li><li>DDNS</li><li>Domain</li></ul><h2>Container Station</h2><p>The first thing you have to install (if you don't have it yet) is Container Station. Just install it from the app center.</p><h2>Folders</h2><p>You'll need 3 different folders on your NAS. Place them where you want to. In my case I created this shared folders with inner subfolders:</p><ul><li>Container Data</li><li>Caddy</li><li>conf</li><li>WebServer</li></ul><p>ContainerData is just for configuration and storage for the docker image and WebServer will be the root of the Caddy server, anything we place there will be server from Caddy.</p><h2>Caddy</h2><p><a href="https://caddyserver.com/">Caddy</a> is the key part of the process. It's a really simple web server and reverse proxy that creates certificates from let's encrypt automatically. The first step will be installing Caddy docker image on Container Station. If you are running the setup process for the first time it's possible you won't get the configuration loaded. In that case: create a container, delete and start the container creation again.</p><p>You'll have to setup:</p><ul><li>Environment: Here ACME_AGREE should be changed to true.</li><li>Network: Choose 3 free ports to make the redirection. You'll need to redirect these ports on the router so take your time to decide what ports are you going to use. The 2015 port is only for development, you don't need to open it on your router.</li><li>Shared folders: In the volume from the host section, you'll have to create 3 volumes. There's a trick. We need to map the configuration file but qnap doesn't allow us to map a file, just folders. To fix this just create a folder called Caddyfile inside conf and delete it once you finish the setup.</li></ul><img src="/content/images/2019/03/Captura-de-pantalla-2019-03-04-a-las-23.02.08-1.png" alt="Volumes configuration"/><h3>Configuration file</h3><p>We almost have Caddy ready, now we just need to create a new file named Caddyfile without extension inside the conf folder. The content, for example, could be:</p><pre><code>     yourowndomain.<span class="call">com</span> {
     tls youremail
    
     root /srv
     browse
    
     log stdout
     errors stdout
    }
</code></pre><p>Save it and restart your container. Caddy should start and it will register a new SSL certificate for your domain. Magic! <img src="/content/images/2019/03/giphy-1.gif"/></p><h2>Ports</h2><p>You'll have to redirect the ports you set up when creating the container. You have to redirect the external 80 port to the port you mapped to the docker 80 port and the same with 443. Your NAS will use custom ports but both external and docker internal ports should match.</p><h2>Domain</h2><p>There's only one missing part: the domain. You'll need to configure your domain to point to your DDNS host. If you have a fixed external IP just use that IP. In my case, I'm using name.com and the qnap DDNS.</p><p>At this point, you have everything ready. Your NAS is serving a static site with SSL. Serving dynamic content either from another service on your NAS on from another docker you'll have to use the IP. Don't use localhost, use the IP instead. For example:</p><pre><code>     yourcustomdomain.<span class="call">com</span> {   
    	tls youremail@here.<span class="property">com</span>   
    	proxy / https://<span class="number">192.168.1.57</span>:<span class="number">4433</span> {     
    		insecure_skip_verify     
    		transparent   
    	}
    }
</code></pre><p>This will allow you to proxy your domain to a different IP while keeping the SSL. Magic, again.</p></div></div></div><div class="footer pure-u-1"><div class="pure-u-1">Â© 2020 Bitomule's learning shack</div><div class="pure-u-1">Generated using <a href="https://github.com/johnsundell/publish">Publish</a>. Written in Swift</div><div class="pure-u-1"><a href="/feed.rss">RSS feed</a></div></div></div></body></html>